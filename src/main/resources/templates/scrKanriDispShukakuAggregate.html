<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head style="height: 100%;">
<meta charset="UTF-8">
<title>ログイン</title>
<!--リセットＣＳＳ-->
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/destyle.css@4.0.0/destyle.min.css">
<!--Font Awesome(無償版)のアイコン-->
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<!-- ★グラフ表示用のchart.js読込み  -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- jQueryがレスポンシブに対応するため必要になるコード...らしい-->
<!-- 参考：https://job-support.ne.jp/blog/javascript/howto-jquery-->
<meta name="viewport" content="width=device-width,initial-scale=1">

<!-- ▽や△のアイコンをCSSで使うためにリンクを貼る -->
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet">

<!--オリジナルＣＳＳ(常に最新のcssを読込むよう工夫)-->
<script type="text/JavaScript">
<!--
   document.write('<link href="/rakulog/css/style.css?ver='+ new Date().getTime() +'" rel="stylesheet" type="text/css">');
//-->
</script>
<!--オリジナルJavaScript(常に最新のcssを読込むよう工夫)-->
<script type="text/JavaScript">
<!--
   document.write('<script src="/rakulog/js/scrKanriDispShukakuAggregate.js?ver='+ new Date().getTime() +'"></script>');
//-->
</script>


<!-- 
	サーバでデプロイする場合、CSS,JavaScript,画像などはドキュメントルート（※）内に配置すること
	※例
	  ＣＳＳ	：/var/www/html/css
	  JavaScript：/var/www/html/js
	  画像	  ：/var/www/html/images
 -->


 
</head>
<body>

<header class="ymd-header">
   収穫状況グラフ表示
</header>
<div class="ymd-navigation">
	<ul class="gnav">
	<li><a th:href="@{/rakulog/indexKanri}"}>ＴＯＰ</a></li>
	<li><a href="">マスタメンテナンス</a>
		<ul>
			<li><a th:href="@{/rakulog/TransitionKanriMainteEmployeeList}">社員情報ﾒﾝﾃﾅﾝｽ</a></li>
			<li><a th:href="@{/rakulog/TransitionKanriMainteHouseList}">ハウス情報ﾒﾝﾃﾅﾝｽ</a></li>
			<li><a th:href="@{/rakulog/TransitionKanriMainteWorkList}">作業情報ﾒﾝﾃﾅﾝｽ</a></li>
		</ul>
	</li>
	<li><a href="">分析・集計</a>
		<ul>
			<li><a th:href="@{/rakulog/TransitionKanriMainteWorkStatusList}">作業内容修正</a></li>
			<li><a th:href="@{/rakulog/TransitionKanriDispWorkStatus}">作業状況確認</a></li>
			<li><a th:href="@{/rakulog/TransitionKanriMainteShukakuSumList}">収穫情報確認</a></li>
            <li><a th:href="@{/rakulog/TransitionKanriDispShukakuAggregate}">収穫状況ｸﾞﾗﾌ表示</a></li>
			<li><a th:href="@{/rakulog/TransitionKanriDummy}">社員能力分析</a></li>
            <li><a th:href="@{/rakulog/TransitionKanriMainteClockInOutList}">出退勤修正</a></li>
		</ul>
	</li>
	</ul>
</div>

<center>
<div class="ymd-base-container">
	
	
	<br>
	<!-- 文言表示エリア -->
	<div class="ymd-container" style="background-color:rgb(0, 128, 128); color: rgb(255,255,255); width: 100%;">
		<span>■収穫ケース数合計：全ハウス合計</span>
	</div>
	<br>
	<canvas id="aggregateChart_All" style="width: 90%; height: 200px"></canvas>
	<br>
	<br>
	<br>
	
	<br>
	<!-- 文言表示エリア -->
	<div class="ymd-container" style="background-color:rgb(0, 128, 128); color: rgb(255,255,255); width: 100%;">
		<span>■収穫ケース数合計：３号隔離</span>
	</div>
	<br>
	<canvas id="aggregateChart_10001" style="width: 90%; height: 200px"></canvas>
	<br>
	<!-- 文言表示エリア -->
	<div class="ymd-container" style="background-color:rgb(0, 128, 128); color: rgb(255,255,255); width: 100%;">
		<span>■収穫ケース数合計：４号隔離</span>
	</div>
	<br>
	<canvas id="aggregateChart_10002" style="width: 90%; height: 200px"></canvas>
	<br>
	<!-- 文言表示エリア -->
	<div class="ymd-container" style="background-color:rgb(0, 128, 128); color: rgb(255,255,255); width: 100%;">
		<span>■収穫ケース数合計：11号隔離</span>
	</div>
	<br>
	<canvas id="aggregateChart_10003" style="width: 90%; height: 200px"></canvas>
	<br>
	<!-- 文言表示エリア -->
	<div class="ymd-container" style="background-color:rgb(0, 128, 128); color: rgb(255,255,255); width: 100%;">
		<span>■収穫ケース数合計：８号土耕</span>
	</div>
	<br>
	<canvas id="aggregateChart_10004" style="width: 90%; height: 200px"></canvas>
	<br>
	<!-- 文言表示エリア -->
	<div class="ymd-container" style="background-color:rgb(0, 128, 128); color: rgb(255,255,255); width: 100%;">
		<span>■収穫ケース数合計：大土耕</span>
	</div>
	<br>
	<canvas id="aggregateChart_10005" style="width: 90%; height: 200px"></canvas>
	<br>
	<!-- 文言表示エリア -->
	<div class="ymd-container" style="background-color:rgb(0, 128, 128); color: rgb(255,255,255); width: 100%;">
		<span>■収穫ケース数合計：西土耕</span>
	</div>
	<br>
	<canvas id="aggregateChart_10006" style="width: 90%; height: 200px"></canvas>
	<br>
	<!-- 文言表示エリア -->
	<div class="ymd-container" style="background-color:rgb(0, 128, 128); color: rgb(255,255,255); width: 100%;">
		<span>■収穫ケース数合計：小土耕</span>
	</div>
	<br>
	<canvas id="aggregateChart_10007" style="width: 90%; height: 200px"></canvas>
	<br>
	
</div>
</center>


<!--       グラフ描画       -->


<script type="text/javascript" th:inline="javascript">

	//  【メモ】
	//  以下のようなグラフを描画したい場合、①と②の配列を準備して
	//  それをグラフにブチ込むカンジ
	//  
	//                   □□□：３号隔離   ■■■：４号隔離
	//  
	//          |              ■      □
	//          |              ■      □
	//       15 |   □         ■      □
	//          |   □       □■      □■
	//          |   □■     □■      □■               □■
	//       10 |   □■     □■      □■               □■ ←②データセット配列
	//          |   □■     □■      □■               □■
	//          |   □■     □■      □■               □■
	//        5 |   □■     □■      □■               □■
	//          |   □■     □■      □■               □■
	//          |   □■     □■      □■               □■
	//          +----------------------------------------------
	//            2024-01  2024-02   2024-03       …   2024-12 ←①ラベル配列
	//  
	//  
	//  ①labels ラベル配列(テキスト配列)
	//  +----------------------------------------------------------+
	//  |2024-01                                                   |
	//  +----------------------------------------------------------+
	//  |2024-02                                                   |
	//  +----------------------------------------------------------+
	//  |2024-03                                                   |
	//
	//                      …中略…
	//
	//  |2024-12                                                   |
	//  +----------------------------------------------------------+
	//  
	//  ②datasets データセット配列(オブジェクト配列)
	//  +----------------------------------------------------------+
	//  |ハウスID：10001(キー値)                                   |
	//  |----------------------------------------------------------|
	//  |ラベル  ：３号隔離                                        |
	//  |データ  ：[0][0][0][0][0][0][0][0][0][0][0][0]            |
	//  |        ※３号隔離のデータを入れる配列を作って0で初期化   |
	//  |          配列の要素数はラベル[2024-01]～[2024-12] の分   |
	//  |          作っといて...                                   |
	//  |                       ▼                                 |
	//  |          後で収穫ケース数合計(boxSum)を入れる            |
	//  |          [20][50][20][15][13][17][25][31][11][9][8][1]   |
	//  |                                                          |
	//  |背景色  ：#FFFFFFF形式で色を指定                          |
	//  |枠線の色：#FFFFFFF形式で色を指定                          |
	//  |                                                          |
	//  +----------------------------------------------------------+
	//  |ハウスID：10002(キー値)                                   |
	//  |----------------------------------------------------------|
	//  |ラベル  ：４号隔離                                        |
	//  |データ  ：[X][X][X][X][X][X][X][X][X][X][X][X]            |
	//  |背景色  ：#FFFFFFF                                        |
	//  |枠線の色：#FFFFFFF                                        |
	//  +----------------------------------------------------------+
	
	
	
	/*<![CDATA[*/
	// Thymeleafで渡されたデータをJavaScriptに変換
	var aggregateData     = /*[[${formKanriDispShukakuAggregateList.detailList_All}]]*/ [];
	var chartDispAreaName = 'aggregateChart_All';
	drowChart(aggregateData, chartDispAreaName);
	
	
	aggregateData         = /*[[${formKanriDispShukakuAggregateList.detailList_10001}]]*/ [];
	chartDispAreaName     = 'aggregateChart_10001';
	drowChart(aggregateData, chartDispAreaName);
	
	
	aggregateData         = /*[[${formKanriDispShukakuAggregateList.detailList_10002}]]*/ [];
	chartDispAreaName     = 'aggregateChart_10002';
	drowChart(aggregateData, chartDispAreaName);
	
	
	aggregateData         = /*[[${formKanriDispShukakuAggregateList.detailList_10003}]]*/ [];
	chartDispAreaName     = 'aggregateChart_10003';
	drowChart(aggregateData, chartDispAreaName);
	
	
	aggregateData         = /*[[${formKanriDispShukakuAggregateList.detailList_10004}]]*/ [];
	chartDispAreaName     = 'aggregateChart_10004';
	drowChart(aggregateData, chartDispAreaName);
	
	
	aggregateData         = /*[[${formKanriDispShukakuAggregateList.detailList_10005}]]*/ [];
	chartDispAreaName     = 'aggregateChart_10005';
	drowChart(aggregateData, chartDispAreaName);
	
	
	aggregateData         = /*[[${formKanriDispShukakuAggregateList.detailList_10006}]]*/ [];
	chartDispAreaName     = 'aggregateChart_10006';
	drowChart(aggregateData, chartDispAreaName);
	
	
	aggregateData         = /*[[${formKanriDispShukakuAggregateList.detailList_10007}]]*/ [];
	chartDispAreaName     = 'aggregateChart_10007';
	drowChart(aggregateData, chartDispAreaName);
	
	
	
	/*]]>*/
	
	
	
	function drowChart(aggregateData, chartDispAreaName) {
	
	
		// データ構造を確認するためにコンソールに出力
		console.log('データ:', aggregateData);
		
		// 集計月、データタイプ（「前年度実績」「本年度予定」「本年度実績」）ごとにデータを整理する
		var labels   = [];
		var datasets = {};
	
		aggregateData.forEach(function(item) {
			var label = item.aggregateMonth + '月'; // 月をラベルとして使用
			
			if (!labels.includes(label)) {
				labels.push(label);
			}
			
			// 背景色をセット
			var bgcolor = '';
			
			if (item.dataType === '前年度実績') {
				
				bgcolor = '#f4a460'; //茶色っぽい色
				
			} else if (item.dataType === '本年度予定') {
				
				bgcolor = '#3cb371'; //緑っぽい色
				
			} else if (item.dataType === '本年度実績') {
				
				bgcolor = '#ff0000'; // 赤やオレンジっぽい色
				
			}
			
			//データタイプをキーにしたdatasets要素が存在しない場合、追加作成する。
			if (!datasets[item.dataType]) {
				datasets[item.dataType] = {
					label: item.dataType,
					data: Array(labels.length).fill(0),  //ラベルの要素数分の配列を作成して0で初期化
					backgroundColor: bgcolor,  // 背景色はデータタイプによって異なる
					borderColor:'#FFFFFF',     // 枠線は白
					borderWidth: 1
				};
			}
			
			var index = labels.indexOf(label);
			datasets[item.dataType].data[index] = parseFloat(item.boxSum);
		});
	
		// ラベルとデータセットを整理
		var chartLabels   = labels;
		var chartDatasets = Object.values(datasets);
	
		// グラフの描画
		var ctx = document.getElementById(chartDispAreaName).getContext('2d');
		var myChart = new Chart(ctx, {
			type: 'bar',
			data: {
				labels: chartLabels,
				datasets: chartDatasets
			},
			options: {
				//responsive:グラフが画面サイズやウィンドウのリサイズに応じて自動的に調整される場合true
				responsive: true,
				//凡例(legendレジェンド)の表示＝true
				//グラフにマウスカーソルをあてた際に表示されるツールチップの表示内＝ラベル(ハウス名): 収穫ケース数合計
				plugins: {
					legend: {
						display: true
					},
					tooltip: {
						callbacks: {
							label: function(context) {
								return context.dataset.label + ': ' + context.raw;
							}
						}
					}
				}
			}
		});

	}
	
	

	// ランダムな色を生成する関数
	function getRandomColor() {
		var letters = '0123456789ABCDEF';
		var color = '#';
		for (var i = 0; i < 6; i++) {
			color += letters[Math.floor(Math.random() * 16)];
		}
		return color;
	}
</script>

</body>
</html>